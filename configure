#!/usr/bin/env sh

for arg in "$@"
do
case $arg in
	"--enable-ocamlbuild")
		echo "OCAMLBUILD=enabled" >> Makefile.config
		;;
	"--disable-ocamlbuild") 
		echo "OCAMLBUILD=disabled" >> Makefile.config
		;;
	"--enable-dune")
		echo "DUNE=enabled" >> Makefile.config
		;;
	"--disable-ocamlbuild") 
		echo "DUNE=disabled" >> Makefile.config
		;;
	*) 
		;;

esac
done

simplify () {
  local name=$1
  local ifs=$IFS
  IFS=".+"
  set -- ${name}
  major="$1"
  minor="$2"
  version="$1.$2"
  IFS=${ifs}
}

copy () {
for dir in lib full precomputed; do 
	if [ -d "$1/${dir}" ]; then
		cp -R $1/${dir}/*.ml ${dir}/;
	fi done
}

simplify `ocaml -vnum`;
copy "current";
if [ -d "${version}" ]; then
	copy "${version}"
fi
echo "let major=${major} let minor=${minor}" > lib/version.ml
